{"version":3,"sources":["services/Stage.ts"],"names":["Stage","Stage.loadData"],"mappings":"AAEA,CAAC;IACC,OAAO,CACJ,MAAM,CAAC,qBAAqB,CAAC,CAC7B,OAAO,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;IAE3B,KAAK,CAAC,OAAO,GAAG,CAAC,IAAI,CAAC,CAAC;IAEvB,SAAS,KAAK,CAAC,EAAE;QACfA,MAAMA,CAACA;YACLA,KAAKA,EAAEA,EAAEA;YACTA,UAAUA,EAAEA,IAAIA;YAChBA,QAAQA,EAAEA,IAAIA;YACdA,QAAQA,EAAEA,QAAQA;YAClBA,KAAKA,EAAEA,IAAIA;YACXA,GAAGA,EAAEA,IAAIA;YACTA,GAAGA,EAAEA,IAAIA;SACVA,CAACA;QAEFA,SAASA,QAAQA,CAACA,IAAIA;YACpBC,IAAIA,CAACA,GAAGA,EAAEA,CAACA,KAAKA,EAAEA,CAACA;YACnBA,IAAIA,IAAIA,GAAGA,IAAIA,CAACA;YAEhBA,IAAIA,CAACA,UAAUA,GAAGA,IAAIA,KAAKA,CAACA,KAAKA,EAAEA,CAACA;YACpCA,IAAIA,CAACA,QAAQA,GAAGA,IAAIA,KAAKA,CAACA,KAAKA,EAAEA,CAACA;YAClCA,IAAIA,CAACA,QAAQA,GAAGA,IAAIA,KAAKA,CAACA,KAAKA,EAAEA,CAACA;YAClCA,IAAIA,KAAKA,GAAGA,IAAIA,CAACA,KAAKA,CAACA;YACvBA,IAAIA,UAAUA,GAAGA,IAAIA,CAACA,UAAUA,CAACA;YACjCA,IAAIA,QAAQA,GAAGA,IAAIA,CAACA,QAAQA,CAACA;YAC7BA,IAAIA,QAAQA,GAAGA,IAAIA,CAACA,QAAQA,CAACA;YAC7BA,KAAKA,CAACA,eAAeA,EAAEA,CAACA;YAGxBA,KAAKA,CAACA,GAAGA,CAACA,UAAUA,CAACA,CAACA;YACtBA,KAAKA,CAACA,GAAGA,CAACA,QAAQA,CAACA,CAACA;YACpBA,KAAKA,CAACA,GAAGA,CAACA,QAAQA,CAACA,CAACA;YACpBA,IAAIA,QAAQA,GAAGA,IAAIA,KAAKA,EAAEA,CAACA;YAC3BA,IAAIA,MAAMA,GAAGA,IAAIA,KAAKA,EAAEA,CAACA;YACzBA,IAAIA,MAAMA,GAAGA,IAAIA,KAAKA,EAAEA,CAACA;YAEzBA,QAAQA,CAACA,MAAMA,GAAGA;gBAChB,IAAI,KAAK,GAAG,IAAI,CAAC,WAAW,GAAG,QAAQ,CAAC,KAAK,CAAC;gBAC9C,IAAI,CAAC,KAAK,GAAG,IAAI,KAAK,CAAC,KAAK,CAAC;oBAC3B,CAAC,EAAE,CAAC;oBACJ,CAAC,EAAE,CAAC;oBACJ,KAAK,EAAE,QAAQ;oBACf,KAAK,EAAE,QAAQ,CAAC,KAAK,GAAG,KAAK;oBAC7B,MAAM,EAAE,QAAQ,CAAC,MAAM,GAAG,KAAK;iBAChC,CAAC,CAAC;gBAEH,KAAK,CAAC,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;gBAC5B,KAAK,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;gBAE9B,UAAU,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;gBAC3B,UAAU,CAAC,IAAI,EAAE,CAAC;gBAClB,UAAU,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;gBAE1B,MAAM,CAAC,MAAM,GAAG;oBACd,IAAI,CAAC,GAAG,GAAG,IAAI,KAAK,CAAC,KAAK,CAAC;wBACzB,CAAC,EAAE,CAAC;wBACJ,CAAC,EAAE,CAAC;wBACJ,KAAK,EAAE,MAAM;wBACb,KAAK,EAAE,QAAQ,CAAC,KAAK,GAAG,KAAK;wBAC7B,MAAM,EAAE,QAAQ,CAAC,MAAM,GAAG,KAAK;qBAChC,CAAC,CAAC;oBAEH,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;oBACvB,QAAQ,CAAC,IAAI,EAAE,CAAC;oBAChB,CAAC,CAAC,OAAO,EAAE,CAAC;gBACd,CAAC,CAAC;gBAEF,MAAM,CAAC,MAAM,GAAG;oBACd,IAAI,CAAC,GAAG,GAAG,IAAI,KAAK,CAAC,KAAK,CAAC;wBACzB,CAAC,EAAE,CAAC;wBACJ,CAAC,EAAE,CAAC;wBACJ,KAAK,EAAE,MAAM;wBACb,KAAK,EAAE,QAAQ,CAAC,KAAK,GAAG,KAAK;wBAC7B,MAAM,EAAE,QAAQ,CAAC,MAAM,GAAG,KAAK;qBAChC,CAAC,CAAC;oBAEH,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;oBACvB,QAAQ,CAAC,IAAI,EAAE,CAAC;oBAChB,QAAQ,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;oBACxB,CAAC,CAAC,OAAO,EAAE,CAAC;gBACd,CAAC,CAAC;gBACF,MAAM,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC;gBACtB,MAAM,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC;YACxB,CAAC,CAACA;YAEFA,QAAQA,CAACA,GAAGA,GAAGA,IAAIA,CAACA,KAAKA,CAACA;YAE1BA,MAAMA,CAACA,CAACA,CAACA,OAAOA,CAACA;QAEnBA,CAACA;IAEHD,CAACA;AAEH,CAAC,CAAC,EAAE,CAAC","file":"services/Stage.js","sourceRoot":"/home/soka/Workspace/vectorizer.js/","sourcesContent":["declare var Konva:any;\n\n(function() {\n  angular\n    .module('Vectorizer.services')\n    .service('Stage', Stage);\n\n  Stage.$inject = ['$q'];\n\n  function Stage($q) {\n    return {\n      stage: {},\n      imageLayer: null,\n      svgLayer: null,\n      loadData: loadData,\n      image: null,\n      svg: null,\n      pbm: null\n    };\n\n    function loadData(data) {\n      var p = $q.defer();\n      var self = this;\n\n      this.imageLayer = new Konva.Layer();\n      this.svgLayer = new Konva.Layer();\n      this.pbmLayer = new Konva.Layer();\n      var stage = this.stage;\n      var imageLayer = this.imageLayer;\n      var svgLayer = this.svgLayer;\n      var pbmLayer = this.pbmLayer;\n      stage.destroyChildren();\n\n\n      stage.add(imageLayer);\n      stage.add(svgLayer);\n      stage.add(pbmLayer);\n      var imageObj = new Image();\n      var svgObj = new Image();\n      var pbmObj = new Image();\n\n      imageObj.onload = function() {\n        var scale = self.offsetWidth / imageObj.width;\n        self.image = new Konva.Image({\n          x: 0,\n          y: 0,\n          image: imageObj,\n          width: imageObj.width * scale,\n          height: imageObj.height * scale\n        });\n\n        stage.width(imageObj.width);\n        stage.height(imageObj.height);\n\n        imageLayer.add(self.image);\n        imageLayer.draw();\n        imageLayer.visible(false);\n\n        svgObj.onload = function() {\n          self.svg = new Konva.Image({\n            x: 0,\n            y: 0,\n            image: svgObj,\n            width: imageObj.width * scale,\n            height: imageObj.height * scale\n          });\n\n          svgLayer.add(self.svg);\n          svgLayer.draw();\n          p.resolve();\n        };\n\n        pbmObj.onload = function() {\n          self.pbm = new Konva.Image({\n            x: 0,\n            y: 0,\n            image: pbmObj,\n            width: imageObj.width * scale,\n            height: imageObj.height * scale\n          });\n\n          pbmLayer.add(self.pbm);\n          pbmLayer.draw();\n          pbmLayer.visible(false);\n          p.resolve();\n        };\n        pbmObj.src = data.pbm;\n        svgObj.src = data.svg;\n      };\n\n      imageObj.src = data.image;\n\n      return p.promise;\n\n    }\n\n  }\n\n})();"]}