{"version":3,"sources":["directives/colorPicker.ts"],"names":["colorPicker","bindClickDocument","setModel","bindMouseMove","setClickHandler"],"mappings":"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","file":"directives/colorPicker.js","sourceRoot":"/home/soka/Workspace/vectorizer.js/","sourcesContent":["(function() {\n  angular\n    .module('Vectorizer.directives')\n    .directive('colorPicker', colorPicker);\n\n  colorPicker.$inject = ['$document'];\n\n  function colorPicker($document) {\n    return {\n      restrict: 'A',\n\n      link: function(scope, element, attrs, ngModel) {\n        scope.$on('setModel', setModel);\n        var ctx, canvas;\n\n        function bindClickDocument(event) {\n          var isChild = element.has(event.target).length > 0;\n          var isSelf = element[0] === event.target;\n          var isInside = isChild || isSelf;\n\n          if (!isInside) {\n            $document.unbind('click', bindClickDocument);\n            canvas.unbind('mousemove', bindMouseMove);\n            canvas.unbind('click', setClickHandler);\n          }\n        }\n\n        function setModel(event, data) {\n          $document.bind('click', bindClickDocument);\n          canvas = element.find('canvas:nth-child(1)');\n          scope.picker = data.model;\n          canvas.bind('mousemove', bindMouseMove);\n          canvas.bind('click', setClickHandler);\n          ctx = canvas[0].getContext('2d');\n        };\n\n        function bindMouseMove(e) {\n\n          var canvasOffset = canvas.offset();\n          var canvasX = Math.floor(e.pageX - canvasOffset.left);\n          var canvasY = Math.floor(e.pageY - canvasOffset.top);\n          var imageData = ctx.getImageData(canvasX, canvasY, 1, 1);\n          var pixel = imageData.data;\n\n\n\n          var pixelColor = 'rgba(' + pixel[0] + ', ' + pixel[1] + ', ' + pixel[2] + ', ' + pixel[3] + ')';\n          scope.app.input[scope.picker] = pixelColor;\n          scope.$apply();\n\n        };\n\n        function setClickHandler(e) {\n          var canvasOffset = canvas.offset();\n          var canvasX = Math.floor(e.pageX - canvasOffset.left);\n          var canvasY = Math.floor(e.pageY - canvasOffset.top);\n          var imageData = ctx.getImageData(canvasX, canvasY, 1, 1);\n          var pixel = imageData.data;\n\n\n          var dColor = pixel[2] + 256 * pixel[1] + 65536 * pixel[0];\n          scope.app.input[scope.picker] = '#' + dColor.toString(16);\n          scope.$apply();\n\n          canvas.unbind('click', setClickHandler);\n          canvas.unbind('mousemove', bindMouseMove);\n        };\n\n      }\n    };\n  }\n})();"]}